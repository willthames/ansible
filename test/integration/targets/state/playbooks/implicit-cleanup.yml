- name: Check that validating corrupted state fails
  hosts: localhost
  strategy: state
  connection: local

  tasks:
    - name: leave first state file alone
      state_file:
        path: "{{ tempdir }}/state_file"
        content: 123
        resource_id: "my_state_file"
      register: first_state_file

    - name: assert that first state file hasn't changed
      assert:
        that:
          - not first_state_file.changed


- name: Check that second state file was implicitly removed
  hosts: localhost
  connection: local

  tasks:
    - name: lookup file
      stat:
        path: "{{ tempdir }}/state_file_2"
      register: stat_file_2

    - name: assert that file 2 no longer exists
      assert:
        that:
          - not stat_file_2.stat.exists
